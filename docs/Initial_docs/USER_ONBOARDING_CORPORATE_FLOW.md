# User Onboarding: Corporate Flow

## Overview

The VS Platform uses a **corporate onboarding model** where **only administrators can create user accounts**. Public self-registration is disabled to ensure proper access control and user management.

## Key Principles

1. **No Public Registration**: Users cannot self-register accounts
2. **Admin-Controlled Access**: Only users with `ADMIN` role can create new accounts
3. **Controlled Onboarding**: All new users are provisioned by administrators
4. **Secure Credential Management**: Passwords can be auto-generated or manually set by admins

---

## Admin User Creation Process

### Prerequisites

- User must be logged in as an `ADMIN`
- Admin must have access to the Admin Panel

### Steps to Create a User

1. **Navigate to Admin Panel**
   - Log in as admin
   - Go to Admin Panel → User Management → Create User
   - Or directly navigate to `/admin/users/create`

2. **Fill in User Details**
   - **Email** (required): User's email address (must be unique)
   - **Name** (optional): User's full name
   - **Password** (optional): 
     - Leave empty to auto-generate a secure random password
     - Or manually enter a password (must meet complexity requirements)
   - **User Category** (required): Select from:
     - Dealer
     - Employee
     - Technician & Service
     - Stakeholder
     - Intern
     - Vendor
   - **Role** (required): Select from:
     - User (default)
     - Admin
     - Editor

3. **Submit and Share Credentials**
   - Click "Create User"
   - If password was auto-generated, it will be displayed **once** after creation
   - **Important**: Copy and securely share the password with the new user
   - The password will not be shown again

### Password Requirements

If manually entering a password, it must:
- Be at least 8 characters long
- Contain at least one uppercase letter (A-Z)
- Contain at least one lowercase letter (a-z)
- Contain at least one number (0-9)

### Auto-Generated Passwords

- 16 characters long
- Contains uppercase, lowercase, numbers, and special characters
- Cryptographically secure random generation
- Displayed only once after user creation

---

## User Login Flow

After an admin creates a user account:

1. **User Receives Credentials**
   - Admin shares email and password (either auto-generated or manually set)
   - Credentials should be shared through a secure channel

2. **User Logs In**
   - Navigate to `/login`
   - Enter email and password
   - Click "LOGIN"

3. **Access Granted**
   - User receives JWT token with their role and category
   - Token includes:
     - User ID
     - Email
     - Role (USER, ADMIN, or EDITOR)
     - Category Role (DEALER, EMPLOYEE, TECHNICIAN, STAKEHOLDER, INTERN, VENDOR)
     - Token version (for invalidation)

4. **Category-Based Access**
   - User can only view videos assigned to their category
   - Category is enforced on both frontend and backend

---

## API Endpoints

### Create User (Admin Only)

**Endpoint**: `POST /api/admin/users/create`

**Authentication**: Required (Admin JWT token)

**Request Body**:
```json
{
  "email": "user@example.com",
  "password": "SecurePass123",  // Optional - omit to auto-generate
  "name": "John Doe",            // Optional
  "categoryRole": "EMPLOYEE",    // Required: DEALER, EMPLOYEE, TECHNICIAN, STAKEHOLDER, INTERN, VENDOR
  "role": "USER"                 // Required: USER, ADMIN, EDITOR
}
```

**Response** (Success - 201):
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "email": "user@example.com",
      "role": "USER",
      "categoryRole": "EMPLOYEE",
      "createdAt": "2024-01-01T00:00:00.000Z"
    },
    "password": "AutoGeneratedPass123!"  // Only present if password was auto-generated
  },
  "message": "User created successfully. Please securely share the generated password with the user."
}
```

**Response** (Error - 409):
```json
{
  "success": false,
  "error": "User with this email already exists"
}
```

### Disabled Endpoint

**Endpoint**: `POST /api/auth/register`

**Status**: Disabled (returns 404 or redirects)

**Reason**: Public registration is disabled. Only admins can create users via `/api/admin/users/create`.

---

## Security Considerations

### Access Control

1. **Backend Enforcement**
   - `/api/admin/users/create` requires `ADMIN` role
   - Middleware `requireAdmin` validates JWT token and role
   - Non-admin users receive 403 Forbidden

2. **Frontend Protection**
   - `/admin/users/create` page uses `useRequireAdmin()` hook
   - Non-admin users are redirected to home page
   - Register page redirects to login

3. **Token Validation**
   - JWT tokens include `tokenVersion` for invalidation
   - Role changes invalidate existing tokens
   - Category changes invalidate existing tokens

### Password Security

- Passwords are hashed using bcrypt (10 rounds)
- Passwords are never returned in API responses (except auto-generated on creation)
- Auto-generated passwords are cryptographically secure
- Password complexity requirements enforced

### Audit Logging

- User creation events are logged
- Role changes are logged
- Category changes are logged
- All admin actions are audited

---

## User Management Workflows

### Creating Multiple Users

1. Navigate to `/admin/users/create`
2. Fill in user details
3. Create user
4. Copy generated password (if auto-generated)
5. Repeat for next user

### Updating User Details

- **Role**: Admin can update user role via `/admin/users`
- **Category**: Admin can update user category via `/admin/users`
- **Email**: Users can update their own email via profile page
- **Password**: Users can change their own password via profile page

### Resetting User Password

**Current Implementation**: Not yet implemented

**Future Enhancement**: Admin-initiated password reset flow
- Admin can trigger password reset
- User receives reset link via email
- User sets new password

---

## Troubleshooting

### User Cannot Log In

1. **Verify Account Exists**
   - Admin checks `/admin/users` to confirm user exists
   - Verify email is correct

2. **Check Password**
   - If password was auto-generated, ensure it was copied correctly
   - If password was manually set, verify it meets complexity requirements

3. **Check User Status**
   - Verify user role and category are set correctly
   - Check if user account is active

### Admin Cannot Create User

1. **Verify Admin Role**
   - Check JWT token includes `role: "ADMIN"`
   - Verify admin is logged in

2. **Check Email Uniqueness**
   - Email must be unique
   - Check if user already exists

3. **Validate Input**
   - Email must be valid format
   - Password must meet complexity requirements (if provided)
   - Category and role must be valid values

### Register Page Access

- `/register` route redirects to `/login`
- This is intentional - public registration is disabled
- Users should contact admin to request account creation

---

## Best Practices

### For Administrators

1. **Secure Password Sharing**
   - Use encrypted channels to share passwords
   - Consider using password managers
   - Never share passwords via email or chat

2. **User Onboarding**
   - Create user accounts before they need access
   - Share credentials through secure channels
   - Document user category assignments

3. **Access Management**
   - Regularly review user roles and categories
   - Remove access for users who no longer need it
   - Use least privilege principle

### For Users

1. **First Login**
   - Change password after first login (if allowed)
   - Verify category access is correct
   - Contact admin if access issues occur

2. **Password Management**
   - Use strong, unique passwords
   - Don't share passwords with others
   - Use password manager if possible

---

## Future Enhancements

### Planned Features

1. **Password Reset Flow**
   - Admin-initiated password reset
   - Email-based password reset
   - Self-service password reset (optional)

2. **Bulk User Import**
   - CSV import for multiple users
   - Bulk password generation
   - Template-based user creation

3. **SSO Integration**
   - Single Sign-On (SSO) support
   - OAuth/OIDC integration
   - LDAP/Active Directory integration

4. **User Invitations**
   - Email invitations with temporary links
   - Self-service account activation
   - Invitation expiration

5. **Account Lifecycle Management**
   - Account activation/deactivation
   - Scheduled account expiration
   - Automated access reviews

---

## Related Documentation

- [First-Time Admin Setup](./FIRST_TIME_ADMIN_SETUP.md) - **Start here for initial setup**
- [Admin Panel Implementation](./admin-ui-implementation-summary.md)
- [Category Role System](./USER_CATEGORY_FEATURE.md)
- [Authentication System](./RELIABILITY_SECURITY_IMPLEMENTATION.md)
- [API Reference](./api-reference.md)

---

## Summary

The VS Platform uses a corporate onboarding model where:

- ✅ Only admins can create user accounts
- ✅ Public registration is disabled
- ✅ Passwords can be auto-generated or manually set
- ✅ User category and role are assigned at creation
- ✅ All admin actions are audited
- ✅ Security is enforced on both frontend and backend

This ensures proper access control, security, and user management for enterprise use.

