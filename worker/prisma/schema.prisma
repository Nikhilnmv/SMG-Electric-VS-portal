// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  EDITOR
  USER
}

enum CategoryRole {
  DEALER
  EMPLOYEE
  TECHNICIAN
  STAKEHOLDER
  INTERN
  VENDOR
}

enum VideoStatus {
  UPLOADED
  PROCESSING
  READY
  APPROVED
  REJECTED
}

enum EventType {
  PLAY
  PAUSE
  PROGRESS
  COMPLETE
}

model User {
  id           String       @id @default(cuid())
  email        String       @unique
  passwordHash String
  role         Role         @default(USER)
  categoryRole CategoryRole @default(INTERN)
  tokenVersion Int          @default(0)
  createdAt    DateTime     @default(now())
  videos       Video[]
  events       AnalyticsEvent[]

  @@map("users")
}

model Video {
  id          String       @id @default(cuid())
  userId      String
  title       String
  description String?
  status      VideoStatus  @default(UPLOADED)
  categoryRole CategoryRole
  s3Key       String
  hlsPath     String?
  duration    Int?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  renditions  Rendition[]
  events      AnalyticsEvent[]

  @@map("videos")
}

model Rendition {
  id        String @id @default(cuid())
  videoId   String
  resolution String
  bitrate   Int
  hlsPath   String
  video     Video  @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@map("renditions")
}

model AnalyticsEvent {
  id         String    @id @default(cuid())
  videoId    String
  userId     String?
  eventType  EventType
  progress   Int?
  timestamp  DateTime  @default(now())
  deviceInfo String?
  video      Video     @relation(fields: [videoId], references: [id], onDelete: Cascade)
  user       User?     @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("analytics_events")
}
